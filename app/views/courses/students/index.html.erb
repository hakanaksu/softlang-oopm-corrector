<ol class="breadcrumb">
  <li> <%= link_to 'Kurse', 'javascript:void(0);', remote: true, id: 'course_breadcrumb_link' %></li>
  <li class="active">Studenten</li>
</ol>
<div class="row">
  <div class="col-sm-12">
    <% if user_signed_in? %>
        <table class="table table-striped table-hover table-bordered">
          <thead>
          <tr>
            <th>#</th>
            <th>Username</th>
            <th>E-Mail</th>
            <th>Punkte</th>
            <th>Fortschritt bis zur Zulassung</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <% @students.each_with_index do |student, index| %>
              <tr>
                <td># <%= index + 1 %></td>
                <td><%= student.username %></td>
                <td><%= student.email %></td>
                <td><%= student_points(student) %> / <%= @course.max_points %></td>
                <td>
                  <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: <%= course_progress(student, student.courses.first) %>%;">
                      <span class="sr-only">35% Complete</span>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="btn-group">
                    <%= link_to 'javascript:void(0);', remote: true, class: 'btn btn-primary btn-sm' do %>
                        <i class="fa fa-bar-chart"></i>
                    <% end %>
                    <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown">
                      <span class="caret"></span>
                      <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                      <% student.assignments.order(:order).each do |assignment| %>
                          <li>
                            <%= link_to 'javascript:void(0)', id: "assignment_#{assignment.id}_student_#{student.id}" do %>
                                <%= "Assignment #{assignment.order}" %>
                            <% end %>
                            <script>
                              $('#assignment_<%= assignment.id %>_student_<%= student.id %>').on('click', function(){
                                  var $panelContent = $('#dashboards_panel');
                                  loadSpinner($panelContent, {type: 'panel'});
                                  ajaxTab($panelContent, '<%= edit_course_student_assignment_url(@course, student, assignment) %>', 'Error');
                              })
                            </script>
                          </li>
                      <% end %>

                    </ul>
                  </div>
                </td>
              </tr>
          <% end %>
          </tbody>
        </table>
    <% else %>
        <div class="panel panel-info">
          Bitte einloggen
        </div>
    <% end %>
  </div>
</div>
<script>
    $(function () {
        $('#dashboard_title').html('Meine Studenten (<%= current_user.email %>)');
        $('#course_breadcrumb_link').on('click', function () {
            var $panelContent = $('#dashboards_panel');
            loadSpinner($panelContent, {type: 'panel'});
            ajaxTab($panelContent, '<%= courses_url %>', 'Fehler');
        })
    })
</script>